<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audit Follow-Up Tracking App · Admin</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app app--ros-admin">
      <aside class="sidebar">
        <div class="brand">
          <span class="brand-mark">AF</span>
          <div>
            <h1>Audit Follow-Up</h1>
            <p>Tracking Workspace</p>
          </div>
        </div>
        <nav class="nav">
          <button class="nav-item active" data-screen="home">Home</button>
          <button class="nav-item" data-screen="audit-list">Audit List</button>
          <button class="nav-item" data-screen="create-audit">Create Audit</button>
          <button class="nav-item" data-screen="create-tasks">Create Templates</button>
          <button class="nav-item" data-screen="task-list">Task List</button>
          <button class="nav-item" data-screen="task-detail">Task Detail</button>
          <button class="nav-item" data-screen="reviewer-queue">Reviewer Queue</button>
          <button class="nav-item" data-screen="store-manager">Store Manager</button>
          <button class="nav-item admin-only" data-screen="admin">Admin Panel</button>
        </nav>
        <div class="sidebar-metrics" id="sidebar-metrics"></div>
        <div class="sidebar-footer hidden" id="sidebar-footer">
          <p>Store Code: <strong id="sidebar-store-code">--</strong></p>
          <p>
            Status:
            <button class="status-pill-button" type="button" id="sidebar-audit-status-button">
              <span class="status-pill" id="sidebar-audit-status">Open</span>
            </button>
          </p>
        </div>
      </aside>
      <main class="main">
        <header class="topbar">
          <div>
            <h2 id="screen-title">Home</h2>
            <p id="screen-subtitle">Search and start a new audit follow-up.</p>
          </div>
          <div class="topbar-actions">
            <button class="secondary admin-only" id="generate-report-button">Generate Report</button>
            <button class="primary" id="new-audit-button">New Audit</button>
          </div>
        </header>

        <section class="content" id="screen-home">
          <div class="grid three">
            <div class="card metric-card">
              <button class="metric-button" type="button" id="home-open-audits-button">
                <p class="eyebrow">Open Audits</p>
                <strong class="metric-value" id="home-open-audits">0</strong>
                <p class="muted">Audits still in progress.</p>
              </button>
            </div>
            <div class="card metric-card">
              <button class="metric-button" type="button" id="home-overdue-audits-button">
                <p class="eyebrow">Overdue Audits</p>
                <strong class="metric-value danger" id="home-overdue-audits">0</strong>
                <p class="muted">Audits with overdue tasks.</p>
              </button>
            </div>
            <div class="card metric-card">
              <button class="metric-button" type="button" id="home-awaiting-approval-button">
                <p class="eyebrow">Waiting Approval</p>
                <strong class="metric-value" id="home-awaiting-approval">0</strong>
                <p class="muted">Proofs pending reviewer action.</p>
              </button>
            </div>
          </div>
          <div class="grid two">
            <div class="card">
              <h3>Find Audits</h3>
              <p class="muted">Open the full audit list with status, auditor, and store filters.</p>
              <button class="primary" id="home-find-audits-button">Open Audit List</button>
            </div>
            <div class="card">
              <h3>Recent Activity</h3>
              <div class="timeline">
                <div class="timeline-item">
                  <span class="dot"></span>
                  <div>
                    <p><strong>Proof submitted</strong> for “Emergency Exit signage”</p>
                    <span>2 hours ago · Submission #2</span>
                  </div>
                </div>
                <div class="timeline-item">
                  <span class="dot warning"></span>
                  <div>
                    <p><strong>Reminder sent</strong> to SM & RM for 3 tasks due in 7 days</p>
                    <span>Yesterday · D-7 rule</span>
                  </div>
                </div>
                <div class="timeline-item">
                  <span class="dot success"></span>
                  <div>
                    <p><strong>Audit AUD-2025-001 created</strong></p>
                    <span>Feb 12, 2025</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="content hidden" id="screen-audit-list">
          <div class="card">
            <h3>Audit List</h3>
            <div class="filter-grid">
              <label class="field">
                Status
                <select id="audit-list-filter-status">
                  <option value="all">All</option>
                  <option value="open">Open</option>
                  <option value="overdue">Overdue</option>
                  <option value="completed">Completed</option>
                </select>
              </label>
              <label class="field">
                Auditor
                <select id="audit-list-filter-auditor"></select>
              </label>
              <label class="field">
                Store
                <select id="audit-list-filter-store"></select>
              </label>
              <label class="field">
                From
                <input id="audit-list-filter-start" type="date" />
              </label>
              <label class="field">
                To
                <input id="audit-list-filter-end" type="date" />
              </label>
            </div>
            <div class="table">
              <div class="table-row header">
                <span>Audit</span>
                <span>Store</span>
                <span>Auditor</span>
                <span>Tasks</span>
                <span>Status</span>
              </div>
              <div id="audit-list-rows"></div>
            </div>
          </div>
        </section>

        <section class="content hidden" id="screen-create-audit">
          <div class="card">
            <h3>Create Audit Follow-Up</h3>
            <div class="grid two">
              <label class="field">
                Audit Identifier
                <input id="audit-id-input" type="text" value="AUD-2025-001" />
              </label>
              <label class="field">
                Audit Date
                <input id="audit-date-input" type="date" value="2025-02-12" />
              </label>
              <label class="field">
                Audit follow-up iteration
                <input id="audit-followup-iteration-input" type="text" value="001" readonly />
              </label>
              <label class="field">
                Audit Follow-up requested by
                <input id="audit-owner-input" type="text" value="" />
              </label>
              <label class="field">
                Audit Type
                <select id="audit-type-select"></select>
              </label>
              <label class="field">
                Store Code
                <input id="audit-store-code-input" type="text" value="ON-204" />
              </label>
              <label class="field">
                Store Name
                <input id="audit-store-input" type="text" value="Toronto Midtown" />
              </label>
              <label class="field">
                Store Manager
                <input id="audit-store-manager-input" type="text" value="Sam Thompson" />
              </label>
              <label class="field">
                Store Manager Email
                <input id="audit-store-manager-email-input" type="email" value="sam.thompson@contoso.com" />
              </label>
              <label class="field">
                Regional Manager
                <input id="audit-regional-manager-input" type="text" value="Kelly Rodgers" />
              </label>
              <label class="field">
                Regional Manager Email
                <input id="audit-regional-manager-email-input" type="email" value="kelly.rodgers@contoso.com" />
              </label>
              <label class="field">
                Director
                <input id="audit-director-input" type="text" value="Guillaume Veillette" />
              </label>
              <label class="field">
                Director Email
                <input id="audit-director-email-input" type="email" value="guillaume.veillette@bell.ca" />
              </label>
              <label class="field">
                Assignee
                <input id="audit-assignee-input" type="text" list="assignee-list" value="Sam Thompson" />
              </label>
              <label class="field">
                Backup Assignee Email
                <input id="audit-backup-assignee-email-input" type="email" value="ros-team@contoso.com" />
              </label>
              <label class="field">
                Follow-up Due Date
                <input id="audit-deadline-input" type="date" value="2025-03-08" />
              </label>
              <label class="field">
                Reminder cadence (days before deadline)
                <select id="audit-reminder-input">
                  <option value="14">14 days</option>
                  <option value="7" selected>7 days</option>
                  <option value="3">3 days</option>
                  <option value="1">1 day</option>
                  <option value="0">On deadline</option>
                </select>
              </label>
              <label class="field">
                Language
                <select id="audit-language-select">
                  <option value="en">English</option>
                  <option value="fr">French</option>
                </select>
              </label>
            </div>
            <details class="section collapsible-panel" open>
              <summary>Escalation recipients</summary>
              <div class="grid two">
                <label class="field field-inline">
                  <input id="audit-reminder-sm" type="checkbox" checked />
                  Reminders: Store Manager
                </label>
                <label class="field field-inline">
                  <input id="audit-reminder-rm" type="checkbox" checked />
                  Reminders: Regional Manager
                </label>
                <label class="field field-inline">
                  <input id="audit-reminder-director" type="checkbox" />
                  Reminders: Director
                </label>
                <label class="field field-inline">
                  <input id="audit-deadline-sm" type="checkbox" checked />
                  Deadline: Store Manager
                </label>
                <label class="field field-inline">
                  <input id="audit-deadline-rm" type="checkbox" checked />
                  Deadline: Regional Manager
                </label>
                <label class="field field-inline">
                  <input id="audit-deadline-director" type="checkbox" checked />
                  Deadline: Director
                </label>
              </div>
            </details>
            <label class="field">
              Summary
              <textarea id="audit-summary-input" rows="4">Store passed 14/20 categories. Key gaps: emergency exit signage, stock room labeling, and fire extinguisher checks.</textarea>
            </label>
            <label class="field">
              Audit Photos Folder Link
              <input id="audit-photos-input" type="text" value="https://sharepoint/ProofLibrary/Proof/AUD-2025-001" />
            </label>
            <div class="alert info hidden" id="audit-draft-alert">
              <span id="audit-draft-message">Draft saved locally.</span>
              <span class="muted" id="audit-draft-timestamp"></span>
            </div>
          </div>
          <details class="card collapsible-panel" open>
            <summary>Email Settings</summary>
            <p class="muted">
              Update the email copy used in the preview. Use placeholders like {storeName},
              {storeCode}, {assigneeName}, {auditType}, {tasksCount}, {dueDate}, {auditorName},
              {appLink}, and {summary}.
            </p>
            <div class="grid two">
              <div class="field">
                <input
                  id="audit-email-subject-template"
                  type="text"
                  placeholder="Subject template"
                  aria-label="Subject template"
                />
              </div>
              <div class="field">
                <input
                  id="audit-email-greeting-template"
                  type="text"
                  placeholder="Greeting template"
                  aria-label="Greeting template"
                />
              </div>
              <div class="field">
                <textarea
                  id="audit-email-intro-template"
                  rows="2"
                  placeholder="Intro text"
                  aria-label="Intro text"
                ></textarea>
              </div>
              <div class="field">
                <textarea
                  id="audit-email-closing-template"
                  rows="2"
                  placeholder="Closing text"
                  aria-label="Closing text"
                ></textarea>
              </div>
            </div>
            <div class="grid two">
              <div class="field">
                <input
                  id="audit-email-details-label"
                  type="text"
                  placeholder="Details label"
                  aria-label="Details label"
                />
              </div>
              <div class="field">
                <input
                  id="audit-email-summary-label"
                  type="text"
                  placeholder="Summary label"
                  aria-label="Summary label"
                />
              </div>
              <div class="field">
                <input
                  id="audit-email-type-label"
                  type="text"
                  placeholder="Type label"
                  aria-label="Type label"
                />
              </div>
              <div class="field">
                <input
                  id="audit-email-tasks-label"
                  type="text"
                  placeholder="Tasks label"
                  aria-label="Tasks label"
                />
              </div>
              <div class="field">
                <input
                  id="audit-email-due-label"
                  type="text"
                  placeholder="Due date label"
                  aria-label="Due date label"
                />
              </div>
              <div class="field">
                <input
                  id="audit-email-link-label"
                  type="text"
                  placeholder="Link label"
                  aria-label="Link label"
                />
              </div>
              <div class="field">
                <input
                  id="audit-email-auditor-label"
                  type="text"
                  placeholder="Auditor label"
                  aria-label="Auditor label"
                />
              </div>
            </div>
            <p class="muted" id="audit-email-settings-source">Stored locally · PowerApps sync placeholder</p>
          </details>
          <div class="card">
            <h3>Audit Email Preview</h3>
            <p class="muted">Generated when you save the audit follow-up.</p>
            <pre id="audit-email-preview" class="preview-card">Preview will appear here.</pre>
            <div class="section">
              <h4>Send activity</h4>
              <div id="audit-email-send-log" class="stack muted">No audit emails sent yet.</div>
            </div>
            <div class="section">
              <h4>Notification activity</h4>
              <div id="audit-notification-log" class="stack muted">No notifications dispatched yet.</div>
            </div>
          </div>
          <div class="card">
            <h3>Audit Task Assignments</h3>
            <p class="muted">Assign task templates to this audit. Drag to reorder and add manager notes.</p>
            <div class="task-assignment">
              <label class="field">
                Task category
                <select id="existing-task-category"></select>
              </label>
            </div>
            <div class="task-template-list" id="existing-task-list"></div>
            <div class="task-summary">
              <div class="task-summary-header">
                <strong>Audit task summary</strong>
                <span class="muted" id="audit-task-count"></span>
              </div>
              <div class="audit-task-list" id="audit-task-summary"></div>
            </div>
          </div>
          <div class="actions page-actions">
            <button class="secondary" id="save-draft-button">Save Draft</button>
            <button class="primary" id="save-continue-button">Save & Launch</button>
          </div>
        </section>

        <section class="content hidden" id="screen-create-tasks">
          <div class="card">
            <h3>Audit Type Library</h3>
            <p class="muted">Manage templates by audit type library.</p>
            <div class="grid two">
              <label class="field">
                Library
                <select id="audit-type-library-select"></select>
              </label>
              <label class="field">
                Actions
                <div class="pill-group">
                  <button class="secondary" id="add-audit-type-button">Add new audit type</button>
                  <button class="primary" id="save-audit-type-button">Save audit type</button>
                </div>
              </label>
            </div>
            <div class="grid two">
              <label class="field">
                Type name (EN)
                <input id="audit-type-name-en" type="text" />
              </label>
              <label class="field">
                Type name (FR)
                <input id="audit-type-name-fr" type="text" />
              </label>
            </div>
            <p class="muted hidden" id="audit-type-readonly-note">
              Only admins can edit audit type libraries.
            </p>
          </div>
          <div class="grid two">
            <div class="card">
              <h3>Category Library</h3>
              <p class="muted">Organize templates by category for the selected audit type.</p>
              <div class="grid two">
                <label class="field">
                  Category name (EN)
                  <input id="category-name-input-en" type="text" />
                </label>
                <label class="field">
                  Category name (FR)
                  <input id="category-name-input-fr" type="text" />
                </label>
              </div>
              <button class="secondary full" id="save-category-button">Add Category</button>
              <div class="task-pool" id="category-list"></div>
            </div>
            <div class="card">
              <h3>Create Task Template</h3>
              <div class="grid two">
                <label class="field">
                  Template Title (EN)
                  <input id="task-title-input-en" type="text" />
                </label>
                <label class="field">
                  Template Title (FR)
                  <input id="task-title-input-fr" type="text" />
                </label>
              </div>
              <label class="field">
                Category
                <select id="task-category-select"></select>
              </label>
              <div class="grid two">
                <label class="field">
                  Template Notes (EN)
                  <textarea id="task-notes-input-en" rows="3"></textarea>
                </label>
                <label class="field">
                  Template Notes (FR)
                  <textarea id="task-notes-input-fr" rows="3"></textarea>
                </label>
              </div>
              <label class="field field-inline">
                <input id="task-proof-required-input" type="checkbox" checked />
                Proof required
              </label>
              <button class="primary full" id="add-task-button">Add Task</button>
            </div>
            <div class="card">
              <h3>Suggested Templates</h3>
              <div class="chip-list">
                <span
                  class="chip"
                  data-category="Loss Prevention"
                  data-category-en="Loss Prevention"
                  data-category-fr="Prévention des pertes"
                  data-title-en="Emergency exit signage"
                  data-title-fr="Signalisation des sorties de secours"
                  data-notes-en="Ensure all emergency exits have clear signage and no obstructions."
                  data-notes-fr="Assurez-vous que toutes les sorties de secours ont une signalisation claire et sans obstruction."
                >
                  Emergency exit signage
                </span>
                <span
                  class="chip"
                  data-category="Store Appearance"
                  data-category-en="Store Appearance"
                  data-category-fr="Apparence du magasin"
                  data-title-en="Stock room labeling"
                  data-title-fr="Étiquetage de la réserve"
                  data-notes-en="Label aisles, bays, and supply zones with updated signage."
                  data-notes-fr="Étiquetez les allées, baies et zones de stock avec une signalisation à jour."
                >
                  Stock room labeling
                </span>
                <span
                  class="chip"
                  data-category="Safety"
                  data-category-en="Safety"
                  data-category-fr="Sécurité"
                  data-title-en="Fire extinguisher inspection"
                  data-title-fr="Inspection des extincteurs"
                  data-notes-en="Verify inspection tags, pressure gauges, and access paths."
                  data-notes-fr="Vérifiez les étiquettes d'inspection, les manomètres et les accès."
                >
                  Fire extinguisher inspection
                </span>
              </div>
              <button class="secondary full" id="bulk-add-button">Bulk Add (3)</button>
            </div>
            <div class="card">
              <h3>Template Library</h3>
              <p class="muted">Templates can be reused across multiple audits in this library.</p>
              <div class="task-pool" id="task-pool-list"></div>
            </div>
          </div>
        </section>

        <section class="content hidden" id="screen-task-list">
          <div class="card">
            <div class="table-header">
              <h3>Task List</h3>
              <div class="table-header-actions">
                <label class="field table-filter">
                  Auditor
                  <select id="task-list-auditor-filter"></select>
                </label>
                <div class="filter-group">
                  <button class="filter active">All</button>
                  <button class="filter">Not Started</button>
                  <button class="filter">Proof Submitted</button>
                  <button class="filter">Overdue</button>
                </div>
              </div>
            </div>
            <div class="table">
              <div class="table-row header">
                <span>Task</span>
                <span>Category</span>
                <span>Due</span>
                <span>Assigned</span>
                <span>Status</span>
              </div>
              <div id="task-list-rows"></div>
            </div>
          </div>
        </section>

        <section class="content hidden modal" id="screen-task-detail">
          <div class="modal-backdrop" id="task-detail-backdrop"></div>
          <div class="modal-content">
            <div class="card">
              <div class="modal-header">
                <h3>Task Details</h3>
                <button class="icon-button" id="close-task-detail" type="button">Close</button>
              </div>
              <ul class="details">
                <li><span>Task</span><strong id="detail-task-title"></strong></li>
                <li><span>Category</span><strong id="detail-task-category"></strong></li>
                <li><span>Audit</span><strong id="detail-task-audit"></strong></li>
                <li><span>Due Date</span><strong id="detail-task-due"></strong></li>
                <li><span>Assigned To</span><strong id="detail-task-assignee"></strong></li>
                <li><span>Assignee Email</span><strong id="detail-task-email"></strong></li>
                <li><span>Proof Required</span><strong id="detail-task-proof"></strong></li>
                <li><span>Status</span><strong id="detail-task-status"></strong></li>
                <li><span>Submission #</span><strong id="detail-task-submission"></strong></li>
              </ul>
              <div class="section">
                <h4>Edit task</h4>
                <div class="grid two">
                  <label class="field">
                    Due date
                    <input id="detail-task-due-input" type="date" />
                  </label>
                  <label class="field">
                    Category
                    <select id="detail-task-category-input"></select>
                  </label>
                  <label class="field">
                    Assign to
                    <input id="detail-task-assignee-input" type="text" list="assignee-list" />
                  </label>
                  <label class="field field-inline">
                    <input id="detail-task-proof-input" type="checkbox" />
                    Proof required
                  </label>
                </div>
                <button class="secondary" id="remove-task-from-audit">Remove from audit</button>
              </div>
              <label class="field">
                Reviewer Notes
                <textarea id="detail-reviewer-notes" rows="4" placeholder="Add approval or rejection feedback..."></textarea>
              </label>
              <div class="actions">
                <button class="secondary" id="reject-task">Reject</button>
                <button class="primary" id="approve-task">Approve</button>
              </div>
            </div>
          </div>
        </section>

        <section class="content hidden" id="screen-reviewer-queue">
          <div class="card">
            <h3>Reviewer Queue</h3>
            <div class="alert info" id="queue-alert">
              <strong>New proof submitted.</strong> <span id="queue-alert-text"></span>
              <button class="link" id="queue-alert-action">View submission</button>
            </div>
            <div class="queue" id="reviewer-queue-list"></div>
          </div>
        </section>

        <section class="content hidden" id="screen-admin">
          <div class="grid two">
            <div class="card">
              <h3>Admin Overview</h3>
              <div class="filter-grid">
                <label class="field">
                  Auditor (ROS)
                  <select id="admin-filter-auditor"></select>
                </label>
                <label class="field">
                  Store
                  <select id="admin-filter-store"></select>
                </label>
                <label class="field">
                  Status
                  <select id="admin-filter-status">
                    <option value="all">All</option>
                    <option value="open">Open</option>
                    <option value="complete">Complete</option>
                  </select>
                </label>
                <label class="field">
                  From
                  <input id="admin-filter-start" type="date" />
                </label>
                <label class="field">
                  To
                  <input id="admin-filter-end" type="date" />
                </label>
              </div>
              <div class="table compact">
                <div class="table-row header">
                  <span>Audit</span>
                  <span>Store</span>
                  <span>Auditor</span>
                  <span>Tasks</span>
                  <span>Status</span>
                </div>
                <div id="admin-audit-rows"></div>
              </div>
            </div>
            <div class="card">
              <h3>Admin Access & Profiles</h3>
              <p class="muted">
                Admin access is based on the Microsoft 365 profiles synced into the directory.
              </p>
              <div class="profile-list" id="profile-list"></div>
            </div>
          </div>
        </section>
      </main>
    </div>
    <div class="app app--store-manager hidden">
      <header class="store-manager-topbar">
        <div class="store-manager-brand">
          <span class="brand-mark">AF</span>
          <div>
            <p class="eyebrow">Store Manager Workspace</p>
            <h2 id="store-manager-title">My Assigned Tasks</h2>
            <p id="store-manager-subtitle">Upload proof and submit tasks to the reviewer queue.</p>
          </div>
        </div>
        <div class="store-manager-actions">
          <label class="field compact" id="store-manager-language-field">
            <span class="muted" id="store-manager-language-label">Language</span>
            <select id="store-manager-locale">
              <option value="en">English</option>
              <option value="fr">Français</option>
            </select>
          </label>
          <button class="secondary" id="admin-message-reviewer-button">Message Reviewer</button>
        </div>
      </header>
      <main class="store-manager-main">
        <section class="content hidden" id="screen-store-manager">
          <div class="card manager-header" id="manager-audit-header"></div>
          <div class="card">
            <div class="table-header">
              <div>
                <h3>Task Overview</h3>
                <p class="muted">Stay on top of due dates and proof submissions.</p>
              </div>
            </div>
            <div class="manager-task-list" id="manager-task-list"></div>
          </div>
        </section>
      </main>
    </div>

    <script type="module" src="admin.js"></script>
    <datalist id="assignee-list"></datalist>
  </body>
</html>
